name: curator_cli test
on:
  workflow_dispatch:
  pull_request:
    branches:
      - master
    paths:
      - 'curator-cli/**'

jobs:
  Test-curator_cli-Package:
    runs-on: windows-latest
    steps:
      - name: Check out repository code
        uses: actions/checkout@v4
      - name: ðŸ¦º Install validation extension
        run: choco install chocolatey-community-validation.extension -y
      - name: ðŸ“¦ Pack Chocolatey Package
        run: choco pack curator-cli/curator-cli.nuspec
      - name: ðŸ“ Validate Package
        run: choco info curator-cli.nupkg
      - name: ðŸ“¥ Install curator-cli package
        run: choco install curator-cli -y --source "'.;https://community.chocolatey.org/api/v2/'"
      - name: âœ… Find Python 3.10+ installation
        id: find-python
        run: |
          $pythonDirs = Get-ChildItem -Path 'C:\Python*' -Directory -ErrorAction SilentlyContinue | 
              Where-Object { $_.Name -match 'Python3\.\d+' } | 
              Sort-Object Name -Descending
          
          foreach ($dir in $pythonDirs) {
              $pythonPath = Join-Path $dir.FullName 'python.exe'
              if (Test-Path $pythonPath) {
                  $version = & $pythonPath --version 2>&1
                  if ($version -match 'Python 3\.(\d+)' -and [int]$matches[1] -ge 10) {
                      Write-Host "Found Python 3.10+: $version at $pythonPath"
                      echo "python_exe=$pythonPath" >> $env:GITHUB_OUTPUT
                      exit 0
                  }
              }
          }
          Write-Host "ERROR: Python 3.10+ not found"
          exit 1
      - name: âœ… Verify Python version
        run: ${{ steps.find-python.outputs.python_exe }} --version
      - name: âœ… Verify curator CLI is available
        run: ${{ steps.find-python.outputs.python_exe }} -m pip list | findstr curator
      - name: ðŸ§ª Test curator CLI help command
        run: ${{ steps.find-python.outputs.python_exe }} -m curator --help


